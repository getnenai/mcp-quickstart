---
description: "NenAI MCP tool usage for workflow deployment, execution, debugging, and platform management"
alwaysApply: false
---

# NenAI MCP Tool Usage Guidelines

This guide helps the AI assistant understand **when** and **how** to use NenAI Platform MCP tools during workflow authoring.

## Important Context: Python SDK vs FSM JSON

**Project Standard:** This project uses **Python SDK workflows** (`nen.workflow`), as documented in `.cursorrules`.

**NenAI MCP Default:** The `nen_create_workflow` tool generates **FSM JSON workflows** by default.

**Implication:** When using MCP tools, be aware of this distinction and convert or adapt as needed.
  
---

## Available NenAI MCP Tools

### Workflow Creation & Management
- `nen_create_workflow` - Generate FSM JSON workflow files
- `update_workflow` - Update/publish workflow files (supports both JSON and Python)
- `nen_list_workflows` - List all workflows in deployment
- `nen_upload` - Upload workflows to NenAI platform

### Workflow Execution & Monitoring
- `nen_run` - Execute a workflow with parameters
- `nen_list_runs` - List workflow execution history
- `get_run_logs` - Retrieve execution logs for debugging
- `get_run_video` - Get video recording of workflow execution
- `nen_artifacts` - Download all artifacts (video, logs) via rsync
- `nen_status` - Check NenAI API/service status

---

## When to Use NenAI MCP Tools

### ✅ ALWAYS Use MCP Tools For:

#### 1. **Workflow Execution & Testing**
```
User: "Run my ezyvet-login workflow"
AI Action: Use nen_run() to execute the workflow
```

**Why:** Direct API access to NenAI platform for execution.

**Tools:** `nen_run`, `nen_list_runs`

---

#### 2. **Debugging Failed Workflows**
```
User: "Why did my workflow fail?"
AI Action: 
  1. Use get_run_logs() to retrieve execution logs
  2. Analyze logs for errors
  3. Suggest fixes
```

**Why:** MCP provides direct access to logs and artifacts.

**Tools:** `get_run_logs`, `get_run_video`, `nen_artifacts`

---

#### 3. **Workflow Discovery & Management**
```
User: "What workflows do I have?"
AI Action: Use nen_list_workflows() to list all available workflows
```

**Why:** Query the NenAI platform for deployed workflows.

**Tools:** `nen_list_workflows`, `nen_status`

---

#### 4. **Publishing/Deploying Workflows**
```
User: "Deploy my workflow to production"
AI Action: Use update_workflow() or nen_upload()
```

**Why:** MCP tools handle platform deployment.

**Tools:** `update_workflow`, `nen_upload`

---

### ⚠️ USE WITH CAUTION For:

#### 5. **Generating New Workflows** (FSM JSON approach)
```
User: "Create a workflow to scrape product data"
AI Decision Tree:
  - If user wants FSM JSON format → Use nen_create_workflow()
  - If user wants Python SDK (default) → Use manual authoring with SDK primitives
```

**Why:** `nen_create_workflow` generates FSM JSON, but this project uses Python SDK.

**Recommended Approach:**
1. Ask user: "Do you want a Python SDK workflow (current standard) or FSM JSON workflow?"
2. If Python SDK: Author manually using `nen.workflow` primitives
3. If FSM JSON: Use `nen_create_workflow()`

**Tool:** `nen_create_workflow`

---

### ❌ DO NOT Use MCP Tools For:

#### 1. **Editing Python Workflow Code**
```
User: "Add a validation step to my workflow.py"
AI Action: Use StrReplace tool directly ❌ NOT nen_create_workflow
```

**Why:** Direct file editing is more precise for code changes.

**Use Instead:** `Read` + `StrReplace` tools

---

#### 2. **Reading Existing Workflow Files**
```
User: "Show me my ezyvet-login workflow"
AI Action: Use Read tool ❌ NOT nen_list_workflows
```

**Why:** Local files are faster and show exact code.

**Use Instead:** `Read`, `Glob`, `LS` tools

---

#### 3. **Syntax Validation**
```
User: "Is my workflow syntax correct?"
AI Action: Read the file and check manually ❌ NOT MCP tools
```

**Why:** Python syntax checking doesn't require API calls.

**Use Instead:** `Read` + `ReadLints` tools

---

#### 4. **Adding Documentation/Comments**
```
User: "Add comments to explain this workflow"
AI Action: Use StrReplace ❌ NOT update_workflow
```

**Why:** Simple text changes don't need platform updates.

**Use Instead:** `StrReplace` tool

---

## Decision Matrix

| User Request | Use MCP? | Tool | Alternative |
|-------------|----------|------|-------------|
| "Create a new workflow" | ⚠️ Ask format first | `nen_create_workflow` (FSM) | Manual authoring (Python SDK) |
| "Run my workflow" | ✅ Yes | `nen_run` | N/A |
| "Why did it fail?" | ✅ Yes | `get_run_logs` | N/A |
| "List my workflows" | ✅ Yes | `nen_list_workflows` | `LS` (for local files) |
| "Edit workflow code" | ❌ No | N/A | `StrReplace` |
| "Show workflow code" | ❌ No | N/A | `Read` |
| "Deploy workflow" | ✅ Yes | `update_workflow` | N/A |
| "Download artifacts" | ✅ Yes | `nen_artifacts` | N/A |
| "Check syntax" | ❌ No | N/A | `Read` + manual review |
| "Debug execution" | ✅ Yes | `get_run_logs` | N/A |

---

## Tool Priority Guidelines

### For New Workflow Creation:

**Option A: Python SDK (Recommended for this project)**
1. Read `.cursorrules` for context
2. Author using `nen.workflow` primitives
3. Create `workflow.py` file manually
4. Test locally, then deploy with `update_workflow` if needed

**Option B: FSM JSON (If explicitly requested)**
1. Use `nen_create_workflow()` to generate FSM JSON
2. Save to `workflows/my_workflows/[name]/workflow.json`

### For Workflow Execution:
1. Always use `nen_run()` - direct API access
2. Follow up with `get_run_logs()` if execution fails

### For Debugging:
1. Use `get_run_logs()` first - fastest, most detailed
2. Use `get_run_video()` if visual debugging needed
3. Use `nen_artifacts()` to download all materials locally

### For Workflow Updates:
1. Local changes: Edit files directly with `StrReplace`
2. Deployment: Use `update_workflow()` to publish changes

---

## Example Workflows

### Example 1: Creating a New Python SDK Workflow

```
User: "Create a workflow to login to GitHub"

AI Response:
"I'll create a Python SDK workflow (the standard for this project).
If you prefer FSM JSON format, let me know and I can use the NenAI 
MCP create_workflow tool instead."

[Proceeds to author Python code using nen.workflow SDK]
```

### Example 2: Running and Debugging a Workflow

```
User: "Run my ezyvet-login workflow"

AI Actions:
1. Call nen_list_workflows() to get workflow ID
2. Call nen_run(workflowId="...", params={...})
3. If run fails, call get_run_logs(messageId="...")
4. Analyze logs and suggest fixes
```

### Example 3: Deploying a Workflow

```
User: "Deploy my workflow to production"

AI Actions:
1. Read local workflow files (workflow.py)
2. Call update_workflow(workflowId="...", files=[...])
3. Confirm successful deployment
```

---

## Best Practices

### 1. **Always Check Local Files First**
Before calling MCP tools, check if the information is available locally:
- Use `Read` for file contents
- Use `LS` or `Glob` to find files
- Use MCP only when you need platform interaction

### 2. **Ask About Format Preferences**
When user requests a new workflow, clarify:
```
"Would you like a Python SDK workflow (current project standard) 
or an FSM JSON workflow?"
```

### 3. **Combine MCP with Local Tools**
Example: When debugging, read local code AND fetch platform logs:
1. Read `workflow.py` to see the code
2. Use `get_run_logs()` to see execution output
3. Correlate code with logs to identify issues

### 4. **Be Explicit About Tool Usage**
When using MCP tools, tell the user:
```
"I'll use the NenAI MCP to execute your workflow..."
"Let me fetch the execution logs from the platform..."
```

### 5. **Handle API Errors Gracefully**
If MCP tools fail (auth issues, network errors):
- Inform user clearly
- Suggest checking Cursor Settings → MCP
- Offer alternative approaches when possible

---

## Tool-Specific Notes

### `nen_create_workflow`
- **Generates:** FSM JSON workflows (not Python SDK)
- **Use when:** User explicitly wants FSM JSON format
- **Avoid when:** Project standard is Python SDK (like this project)

### `update_workflow`
- **Accepts:** Both JSON and Python files
- **Use for:** Deploying local changes to NenAI platform
- **Note:** Requires workflow ID (use `nen_list_workflows` to find)

### `get_run_logs`
- **Returns:** Full text logs for immediate analysis
- **Best for:** Quick debugging, error diagnosis
- **Tip:** Search logs for "error", "failed", "exception"

### `nen_artifacts`
- **Downloads:** Video + logs via rsync
- **Use when:** User needs persistent local copies
- **Alternative:** `get_run_logs` for logs only (faster)

---

## Summary

**Key Principles:**
1. **Use MCP for platform interactions** (execution, deployment, logs)
2. **Use local tools for code operations** (editing, reading, validation)
3. **Clarify format preferences** when creating new workflows
4. **Be transparent** about which tools you're using
5. **Prioritize user's project standards** (Python SDK in this case)

**Quick Reference:**
- Execute workflow → `nen_run`
- Debug failure → `get_run_logs`
- Deploy workflow → `update_workflow`
- List workflows → `nen_list_workflows`
- Create workflow → Ask format first, then choose approach
- Edit workflow → Direct file editing (not MCP)

---

**Last Updated:** 2026-02-04  
**Version:** 1.0.0
