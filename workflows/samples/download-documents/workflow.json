{
  "metadata": {
    "recording_mode": "tool_calls",
    "mode": "anthropic",
    "tool_version": "computer_use_20250124"
  },
  "model": "claude-sonnet-4-20250514",
  "provider": "anthropic",
  "tool_version": "computer_use_20250124",
  "spans": [
    {"id": "setup", "name": "Environment Setup", "description": "Launch browser and navigate"},
    {"id": "auth", "name": "Authentication", "description": "Login to the application"},
    {"id": "search", "name": "Patient Search", "description": "Find the target patient"},
    {"id": "download", "name": "Download", "description": "Download all documents"},
    {"id": "complete", "name": "Completion", "description": "Verify downloads"}
  ],
  "variables": [
    {
      "name": "PATIENT_NAME",
      "value": "",
      "description": "Patient name to search for"
    },
    {
      "name": "LOGIN_EMAIL",
      "value": "",
      "description": "Login email"
    },
    {
      "name": "LOGIN_PASSWORD",
      "value": "",
      "type": "password",
      "secret_id": "login_password",
      "description": "Login password"
    }
  ],
  "states": [
    {
      "id": "launch_browser",
      "description": "Launch the browser",
      "message_template": "Find and click the browser icon (Chromium or Firefox) to launch it.",
      "max_attempts": 2,
      "span_id": "setup"
    },
    {
      "id": "dismiss_popups",
      "description": "Dismiss any startup popups",
      "message_template": "Close any popups, banners, or welcome dialogs.",
      "max_iterations": 5,
      "max_attempts": 1,
      "span_id": "setup"
    },
    {
      "id": "focus_address_bar",
      "description": "Click address bar",
      "message_template": "Click the address bar at the top of the browser.",
      "max_iterations": 3,
      "max_attempts": 1,
      "span_id": "setup"
    },
    {
      "id": "type_url",
      "description": "Type the application URL",
      "tool": "computer",
      "tool_input_template": {
        "action": "type",
        "text": "https://app.example.com"
      },
      "max_attempts": 1,
      "span_id": "setup"
    },
    {
      "id": "press_enter",
      "description": "Navigate to the URL",
      "tool": "computer",
      "tool_input_template": {
        "action": "key",
        "text": "Return"
      },
      "max_attempts": 1,
      "span_id": "setup"
    },
    {
      "id": "perform_login",
      "description": "Log in to the application",
      "message_template": "If a login page is visible, enter email '${LOGIN_EMAIL}' and password. Then click the login button. If already logged in, do nothing.",
      "max_iterations": 15,
      "max_attempts": 2,
      "span_id": "auth"
    },
    {
      "id": "verify_logged_in",
      "description": "Verify successful login",
      "type": "verification",
      "comparison_config": {
        "strategy": "vlm_similarity",
        "prompt": "Is the user logged in? Look for a main navigation menu or dashboard."
      },
      "verification_config": {
        "strategy": "verify_until",
        "wait_timeout": 30,
        "check_interval": 5
      },
      "max_attempts": 2,
      "span_id": "auth"
    },
    {
      "id": "navigate_to_patients",
      "description": "Navigate to patients section",
      "message_template": "Find and click on 'Patients' or 'Clients' in the navigation menu.",
      "max_iterations": 10,
      "max_attempts": 2,
      "span_id": "search"
    },
    {
      "id": "search_patient",
      "description": "Search for the patient",
      "message_template": "Find the search field and type '${PATIENT_NAME}'. Wait for search results to appear.",
      "max_iterations": 10,
      "max_attempts": 2,
      "span_id": "search"
    },
    {
      "id": "verify_patient_found",
      "description": "Verify exactly one patient found",
      "type": "verification",
      "comparison_config": {
        "strategy": "vlm_similarity",
        "prompt": "Is there exactly one patient result matching '${PATIENT_NAME}'?"
      },
      "verification_config": {
        "strategy": "verify_now",
        "failure_recovery": {
          "id": "clear_search",
          "message_template": "Clear the search field and try again.",
          "max_iterations": 3
        }
      },
      "max_attempts": 2,
      "span_id": "search"
    },
    {
      "id": "select_patient",
      "description": "Click on the patient to open profile",
      "message_template": "Click on the patient '${PATIENT_NAME}' to open their profile.",
      "max_iterations": 5,
      "max_attempts": 2,
      "span_id": "search"
    },
    {
      "id": "navigate_to_documents",
      "description": "Navigate to documents section",
      "message_template": "Look for a 'Documents', 'Files', or 'Attachments' tab or section. Click on it.",
      "max_iterations": 10,
      "max_attempts": 2,
      "span_id": "download"
    },
    {
      "id": "download_all_documents",
      "description": "Download each document",
      "message_template": "For each document/PDF visible:\n1. Click on the document or download button\n2. If a download dialog appears, click Save or Download\n3. Wait for download to complete\n4. Move to the next document\n\nRepeat until all documents are downloaded.",
      "max_iterations": 30,
      "max_attempts": 2,
      "span_id": "download"
    },
    {
      "id": "verify_downloads",
      "description": "Verify documents were downloaded",
      "type": "verification",
      "comparison_config": {
        "strategy": "bash_command",
        "command": "ls /artifacts/*.pdf 2>/dev/null | wc -l",
        "expected_output": "1"
      },
      "verification_config": {
        "strategy": "verify_until",
        "wait_timeout": 60,
        "check_interval": 10
      },
      "max_attempts": 2,
      "span_id": "complete"
    }
  ]
}
